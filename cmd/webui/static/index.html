<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QWID Wallet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }
        .header {
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 {
            color: #00d4ff;
            font-size: 24px;
        }
        .header-info {
            font-size: 14px;
            color: #888;
        }
        .tabs {
            display: flex;
            background: rgba(0,0,0,0.2);
            overflow-x: auto;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #888;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.3s;
        }
        .tab:hover {
            background: rgba(255,255,255,0.05);
            color: #fff;
        }
        .tab.active {
            background: rgba(0,212,255,0.1);
            color: #00d4ff;
            border-bottom: 2px solid #00d4ff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .panel {
            display: none;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .panel.active {
            display: block;
        }
        .card {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .card h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 16px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .stat-item {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        .stat-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
        }
        .stat-value.highlight {
            color: #00d4ff;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 14px;
            margin-bottom: 10px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #00d4ff;
        }
        input::placeholder {
            color: #666;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #000;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.3);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #cc0000 100%);
            color: #fff;
        }
        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .alert-success {
            background: rgba(0,255,100,0.1);
            border: 1px solid rgba(0,255,100,0.3);
            color: #00ff64;
        }
        .alert-error {
            background: rgba(255,0,0,0.1);
            border: 1px solid rgba(255,0,0,0.3);
            color: #ff4757;
        }
        .alert-warning {
            background: rgba(255,200,0,0.1);
            border: 1px solid rgba(255,200,0,0.3);
            color: #ffc800;
        }
        .wallet-info {
            font-family: monospace;
            word-break: break-all;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        .balance-display {
            text-align: center;
            padding: 30px;
        }
        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            color: #00d4ff;
        }
        .balance-label {
            font-size: 14px;
            color: #888;
            margin-top: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #888;
            font-size: 12px;
        }
        .hidden {
            display: none !important;
        }
        .syncing-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ffc800;
            animation: pulse 1s infinite;
            margin-right: 5px;
        }
        .syncing-indicator.synced {
            background: #00ff64;
            animation: none;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .staking-details {
            margin-top: 15px;
        }
        .staking-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            margin-bottom: 5px;
        }
        #message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>QWID Wallet</h1>
        <div class="header-info">
            <span id="nodeInfo">Connecting...</span>
            <span class="syncing-indicator" id="syncIndicator"></span>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" data-tab="wallet">Wallet</button>
        <button class="tab" data-tab="account">Account</button>
        <button class="tab" data-tab="send">Send</button>
        <button class="tab" data-tab="staking">Staking</button>
        <button class="tab" data-tab="history">History</button>
        <button class="tab" data-tab="details">Details</button>
        <button class="tab" data-tab="escrow">Escrow</button>
        <button class="tab" data-tab="smartcontract">Smart Contract</button>
        <button class="tab" data-tab="vote">Vote</button>
        <button class="tab" data-tab="dex">DEX</button>
        <button class="tab" data-tab="peers">Peers</button>
        <button class="tab" data-tab="logs">Logs</button>
    </div>

    <div class="container">
        <div id="message"></div>

        <!-- Wallet Panel -->
        <div class="panel active" id="panel-wallet">
            <div class="card">
                <h3>Load Wallet</h3>
                <div class="form-group">
                    <label>Wallet Number (0-255)</label>
                    <input type="number" id="walletNumber" placeholder="0" min="0" max="255" value="0">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="walletPassword" placeholder="Enter password">
                </div>
                <div style="display:flex;gap:10px;">
                    <button class="btn-primary" onclick="loadWallet()">Load Wallet</button>
                    <button class="btn-secondary" onclick="createWallet()">Create New Wallet</button>
                </div>
            </div>

            <div class="card" id="walletInfoCard" style="display:none;">
                <h3>Wallet Information</h3>
                <div id="walletDetails"></div>
            </div>

            <div class="card">
                <h3>Change Password</h3>
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="currentPassword" placeholder="Current password">
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword" placeholder="New password">
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm new password">
                </div>
                <button class="btn-secondary" onclick="changePassword()">Change Password</button>
            </div>

            <div class="card">
                <h3>Mnemonic Words</h3>
                <button class="btn-secondary" onclick="showMnemonic()">Show Mnemonic Words</button>
                <div id="mnemonicDisplay" style="margin-top:15px;"></div>
            </div>
        </div>

        <!-- Account Panel -->
        <div class="panel" id="panel-account">
            <div class="card">
                <div class="balance-display">
                    <div class="balance-amount" id="totalBalance">0.00000000</div>
                    <div class="balance-label">Total Holdings (QWD)</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Available Balance</div>
                    <div class="stat-value" id="availableBalance">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Staked Amount</div>
                    <div class="stat-value" id="stakedAmount">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Locked Amount</div>
                    <div class="stat-value" id="lockedAmount">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Rewards</div>
                    <div class="stat-value highlight" id="rewardsAmount">0.00</div>
                </div>
            </div>

            <div class="card">
                <h3>Network Stats</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Node Status</div>
                        <div class="stat-value" id="nodeStatus">
                            <span class="syncing-indicator" id="accountSyncIndicator"></span>
                            <span id="syncStatusText">-</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Block Height</div>
                        <div class="stat-value" id="blockHeight">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Transactions in Last Block</div>
                        <div class="stat-value highlight" id="txInBlock">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Pending in Pool</div>
                        <div class="stat-value highlight" id="txPending">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">TPS</div>
                        <div class="stat-value" id="tps">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Difficulty</div>
                        <div class="stat-value" id="difficulty">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Price Oracle</div>
                        <div class="stat-value" id="priceOracle">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Rand Oracle</div>
                        <div class="stat-value" id="randOracle">-</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Staking Details</h3>
                <div id="stakingDetails" class="staking-details">
                    <p style="color:#666;">No staking information available</p>
                </div>
            </div>

            <div class="card">
                <h3>PubKey Registration</h3>
                <div id="pubkeyInfo" style="font-family:monospace;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;">
                        <div>
                            <div style="margin-bottom:5px;">Primary PubKey:</div>
                            <span id="primaryPubKeyStatus" style="font-weight:bold;">Loading...</span>
                        </div>
                        <div>
                            <div style="margin-bottom:5px;">Secondary PubKey:</div>
                            <span id="secondaryPubKeyStatus" style="font-weight:bold;">Loading...</span>
                        </div>
                    </div>
                    <div id="pubkeyAddresses" style="margin-top:10px;"></div>
                </div>
            </div>

            <div class="card">
                <h3>Account Details</h3>
                <div id="accountDetails" style="font-family:monospace;">
                    <p>Escrow Delay: <span id="accountEscrowDelay" style="color:#aaa;">-</span> blocks</p>
                    <p>Multi-Sig Required: <span id="accountMultiSig" style="color:#aaa;">-</span></p>
                    <p>Sent Transactions: <span id="accountSentCount" style="color:#aaa;">-</span></p>
                    <p>Received Transactions: <span id="accountRecvCount" style="color:#aaa;">-</span></p>
                </div>
            </div>
        </div>

        <!-- Send Panel -->
        <div class="panel" id="panel-send">
            <div class="card">
                <h3>Send QWD</h3>
                <div class="form-group">
                    <label>Recipient Address (hex or delegated account number 1-255)</label>
                    <input type="text" id="recipientAddress" placeholder="Enter address or account number">
                </div>
                <div class="form-group">
                    <label>Amount (QWD)</label>
                    <input type="number" id="sendAmount" placeholder="0.00000000" step="0.00000001" min="0">
                </div>
                <div class="form-group">
                    <label>Locked Amount (QWD) - Optional</label>
                    <input type="number" id="lockedAmount" placeholder="0" step="0.00000001" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>Release Per Block - Optional</label>
                    <input type="number" id="releasePerBlock" placeholder="0" step="0.00000001" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>Delegated Account For Locking (1-255)</label>
                    <input type="number" id="delegatedAccountForLocking" placeholder="1" min="1" max="255" value="1">
                </div>
                <div class="form-group">
                    <label>Multi-Sig Transaction Hash (optional)</label>
                    <input type="text" id="multiSigTxHash" placeholder="Hash of transaction to confirm (64 hex chars)">
                </div>
                <div class="form-group">
                    <label>Smart Contract Data (hex, optional)</label>
                    <textarea id="smartContractData" rows="3" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;font-family:monospace;" placeholder="Enter hex data for smart contract"></textarea>
                </div>
                <div class="form-group" style="display:flex;gap:20px;">
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="includePubKey" style="width:auto;margin-right:8px;">
                        Include Public Key
                    </label>
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="usePrimaryEncryption" checked style="width:auto;margin-right:8px;">
                        Use Primary Encryption
                    </label>
                </div>
                <button class="btn-primary" onclick="sendTransaction()">Send Transaction</button>
            </div>

            <div class="card">
                <h3>Cancel Transaction</h3>
                <div class="form-group">
                    <label>Transaction Hash to Cancel</label>
                    <input type="text" id="cancelTxHash" placeholder="Enter transaction hash (64 hex chars)">
                </div>
                <button class="btn-danger" onclick="cancelTransaction()">Cancel Transaction</button>
            </div>
        </div>

        <!-- Staking Panel -->
        <div class="panel" id="panel-staking">
            <div class="card">
                <h3>Staking Operations</h3>

                <div class="form-group">
                    <label>Action</label>
                    <div style="display:flex;gap:20px;margin-bottom:15px;">
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="stakingAction" value="stake" checked style="width:auto;margin-right:8px;">
                            Stake
                        </label>
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="stakingAction" value="unstake" style="width:auto;margin-right:8px;">
                            Unstake
                        </label>
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="stakingAction" value="withdraw" style="width:auto;margin-right:8px;">
                            Withdraw Rewards
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Delegated Account (1-254 or hex address)</label>
                    <input type="text" id="stakingDelegatedAccount" placeholder="1" value="1">
                </div>

                <div class="form-group">
                    <label>Amount (QWD)</label>
                    <input type="number" id="stakingAmount" placeholder="0.00000000" step="0.00000001" min="0">
                </div>

                <div class="form-group">
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="intendOperator" style="width:auto;margin-right:8px;">
                        Intend to be an Operator
                    </label>
                </div>

                <div class="form-group" style="display:flex;gap:20px;">
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="stakingUsePrimaryEncryption" checked style="width:auto;margin-right:8px;">
                        Use Primary Encryption
                    </label>
                </div>

                <button class="btn-primary" onclick="executeStaking()">Execute</button>
            </div>
        </div>

        <!-- History Panel -->
        <div class="panel" id="panel-history">
            <div class="card">
                <h3>Pending Transactions</h3>
                <button class="btn-secondary" onclick="refreshPending()" style="margin-bottom:15px;">Refresh Pending</button>
                <div id="pendingList">
                    <p style="color:#666;">Click Refresh to load pending transactions</p>
                </div>
            </div>

            <div class="card">
                <h3>Transaction History</h3>
                <button class="btn-primary" onclick="refreshHistory()" style="margin-bottom:15px;">Refresh History</button>
                <div id="historyList">
                    <p style="color:#666;">Click Refresh to load transactions</p>
                </div>
            </div>
        </div>

        <!-- Details Panel -->
        <div class="panel" id="panel-details">
            <div class="card">
                <h3>Search</h3>
                <div class="form-group">
                    <label>Transaction Hash / Address / Block Height</label>
                    <input type="text" id="searchQuery" placeholder="Enter hash, address, or block height">
                </div>
                <button class="btn-primary" onclick="searchDetails()">Search</button>
            </div>
            <div class="card" id="detailsResult" style="display:none;">
                <h3>Result</h3>
                <pre id="detailsContent" style="white-space:pre-wrap;word-break:break-all;font-size:12px;"></pre>
            </div>
        </div>

        <!-- Escrow Panel -->
        <div class="panel" id="panel-escrow">
            <div class="card">
                <h3>Account Security Settings</h3>
                <p style="color:#888;margin-bottom:20px;">Configure escrow delay and multi-signature requirements for your account.</p>

                <div class="form-group">
                    <label>Escrow Transaction Delay (blocks)</label>
                    <input type="number" id="escrowDelay" placeholder="0" min="0" value="0">
                    <p style="color:#666;font-size:11px;margin-top:5px;">Number of blocks to delay transactions (0 = no delay)</p>
                </div>

                <div class="form-group">
                    <label>Multi-Signature Approvals Required</label>
                    <input type="number" id="multiSigNumber" placeholder="0" min="0" max="255" value="0">
                    <p style="color:#666;font-size:11px;margin-top:5px;">Number of approvals needed (0-255)</p>
                </div>

                <div class="form-group">
                    <label>Multi-Signature Addresses (comma separated)</label>
                    <textarea id="multiSigAddresses" rows="3" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;font-family:monospace;" placeholder="address1, address2, address3..."></textarea>
                </div>

                <div class="form-group" style="display:flex;gap:20px;">
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="escrowIncludePubKey" style="width:auto;margin-right:8px;">
                        Include Public Key
                    </label>
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="escrowUsePrimaryEncryption" checked style="width:auto;margin-right:8px;">
                        Use Primary Encryption
                    </label>
                </div>

                <button class="btn-primary" onclick="modifyAccount()">Modify Account</button>
            </div>
        </div>

        <!-- Smart Contract Panel -->
        <div class="panel" id="panel-smartcontract">
            <div class="card">
                <h3>Call Smart Contract</h3>

                <div class="form-group">
                    <label>Smart Contract Address</label>
                    <input type="text" id="scAddress" placeholder="Enter contract address (hex)">
                </div>

                <div class="form-group">
                    <label>ABI</label>
                    <textarea id="scABI" rows="3" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;font-family:monospace;font-size:12px;" placeholder="Paste contract ABI JSON here"></textarea>
                </div>

                <button class="btn-secondary" onclick="parseABI()" style="margin-bottom:15px;">Update ABI</button>

                <div class="form-group">
                    <label>Function</label>
                    <select id="scFunctionSelect" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;" onchange="onFunctionSelected()">
                        <option value="">-- Select Function --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Input Parameters (comma-separated)</label>
                    <input type="text" id="scInputParams" placeholder="e.g. 0x1234...abc,100,&quot;hello&quot;">
                </div>

                <button class="btn-secondary" onclick="encodeInputData()" style="margin-bottom:15px;">Encode Input</button>

                <div class="form-group">
                    <label>Encoded Input Data (hex)</label>
                    <textarea id="scInputData" rows="3" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;font-family:monospace;font-size:12px;" placeholder="Function selector + encoded parameters"></textarea>
                </div>

                <div style="display:flex;gap:10px;margin-bottom:15px;">
                    <button class="btn-primary" onclick="callSmartContract()">Call Contract (View)</button>
                    <button class="btn-secondary" onclick="prepareContractTx()">Send to Contract</button>
                </div>

                <div class="form-group">
                    <label>Output</label>
                    <textarea id="scOutput" rows="3" readonly style="width:100%;padding:12px;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#0f0;font-family:monospace;font-size:12px;"></textarea>
                </div>
            </div>

            <div class="card">
                <h3>Compile &amp; Deploy Smart Contract</h3>

                <div class="form-group">
                    <label>Solidity Source Code</label>
                    <textarea id="scSourceCode" rows="20" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;font-family:monospace;font-size:12px;">// SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.8.4;

contract Coin {

    // The keyword "public" makes variables
    // accessible from other contracts
    address public minter;
    mapping (address => int64) public balances;
    string public constant name = "WONABRU TOKEN";
    string public constant symbol = "WNB";
    uint8 public constant decimals = 2;

    function balanceOf(address tokenOwner) public view returns (int64) {
        return balances[tokenOwner];
    }

    // Events allow clients to react to specific
    // contract changes you declare
    event Sent(address from, address to, int64 amount);

    // Constructor code is only run when the contract
    // is created
    constructor() {
        minter = msg.sender;
    }

    // Sends an amount of newly created coins to an address
    // Can only be called by the contract creator
    function mint(address receiver, int64 amount) public {
        require(msg.sender == minter, "only minter can mint");
        balances[receiver] += amount;
    }

    // Sends an amount of existing coins
    // from any caller to an address
    function transfer(address receiver, int64 amount) public {
        require(amount &lt;= balances[msg.sender], "insufficient balance");

        balances[msg.sender] -= amount;
        balances[receiver] += amount;
        emit Sent(msg.sender, receiver, amount);
    }
}</textarea>
                </div>

                <button class="btn-primary" onclick="compileContract()" style="margin-bottom:15px;">Compile Contract</button>

                <div class="form-group">
                    <label>Compiled Bytecode</label>
                    <textarea id="scBytecode" rows="3" style="width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#fff;font-family:monospace;font-size:12px;" placeholder="Compiled bytecode will appear here (or paste pre-compiled bytecode)"></textarea>
                </div>

                <button class="btn-secondary" onclick="deployContract()">Deploy Contract</button>
                <p style="color:#888;margin-top:10px;font-size:12px;">Deploy sets recipient to "0", amount to "0", and bytecode as Smart Contract Data in the Send tab.</p>
            </div>
        </div>

        <!-- Vote Panel -->
        <div class="panel" id="panel-vote">
            <div class="card">
                <h3>Vote on Encryption Changes</h3>
                <p style="color:#888;margin-bottom:20px;">Vote to pause, unpause, or replace the blockchain's cryptographic algorithms. These votes affect the entire network.</p>

                <div class="form-group">
                    <label>Primary Encryption Actions</label>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                        <button class="btn-secondary" onclick="vote('pausePrimary')">Pause Primary</button>
                        <button class="btn-secondary" onclick="vote('unpausePrimary')">Unpause Primary</button>
                        <button class="btn-danger" onclick="vote('replacePrimary')">Replace Primary</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>New Primary Encryption Name (for Replace action)</label>
                    <input type="text" id="newPrimaryEncryption" placeholder="e.g., Falcon-512, MAYO-5">
                </div>

                <div style="border-top:1px solid rgba(255,255,255,0.1);margin:20px 0;"></div>

                <div class="form-group">
                    <label>Secondary Encryption Actions</label>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                        <button class="btn-secondary" onclick="vote('pauseSecondary')">Pause Secondary</button>
                        <button class="btn-secondary" onclick="vote('unpauseSecondary')">Unpause Secondary</button>
                        <button class="btn-danger" onclick="vote('replaceSecondary')">Replace Secondary</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>New Secondary Encryption Name (for Replace action)</label>
                    <input type="text" id="newSecondaryEncryption" placeholder="e.g., Falcon-512, MAYO-5">
                </div>
            </div>

            <div class="card">
                <h3>Current Encryption Status</h3>
                <div id="encryptionStatus" style="font-family:monospace;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                        <div>
                            <h4 style="margin-bottom:10px;color:#4fc3f7;">Primary Encryption</h4>
                            <p>Name: <span id="currentPrimary" style="color:#fff;">Loading...</span></p>
                            <p>Status: <span id="primaryPausedStatus">Loading...</span></p>
                            <p>PubKey Size: <span id="primaryPubKeyLen" style="color:#aaa;">-</span> bytes</p>
                            <p>Signature Size: <span id="primarySigLen" style="color:#aaa;">-</span> bytes</p>
                        </div>
                        <div>
                            <h4 style="margin-bottom:10px;color:#ce93d8;">Secondary Encryption</h4>
                            <p>Name: <span id="currentSecondary" style="color:#fff;">Loading...</span></p>
                            <p>Status: <span id="secondaryPausedStatus">Loading...</span></p>
                            <p>PubKey Size: <span id="secondaryPubKeyLen" style="color:#aaa;">-</span> bytes</p>
                            <p>Signature Size: <span id="secondarySigLen" style="color:#aaa;">-</span> bytes</p>
                        </div>
                    </div>
                    <div style="border-top:1px solid rgba(255,255,255,0.1);margin:15px 0;"></div>
                    <p>Voting Window: every <span id="encVotingWindow" style="color:#aaa;">-</span> blocks</p>
                </div>
            </div>
        </div>

        <!-- DEX Panel -->
        <div class="panel" id="panel-dex">
            <div class="card">
                <h3>Decentralized Exchange</h3>

                <div class="form-group">
                    <label>Select Token</label>
                    <select id="dexTokenSelect" onchange="updateDexToken()" style="font-family:monospace;font-size:12px;">
                        <option value="">-- Select Token --</option>
                    </select>
                    <div style="display:flex;gap:10px;margin-top:8px;">
                        <button class="btn-secondary" onclick="refreshTokens()">Refresh Tokens</button>
                        <button class="btn-secondary" onclick="copyTokenAddress()">Copy Address</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Operation</label>
                    <div style="display:flex;gap:15px;flex-wrap:wrap;margin-bottom:15px;">
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="dexOperation" value="addLiquidity" checked style="width:auto;margin-right:8px;">
                            Add Liquidity
                        </label>
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="dexOperation" value="withdrawToken" style="width:auto;margin-right:8px;">
                            Withdraw Token
                        </label>
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="dexOperation" value="withdrawQWD" style="width:auto;margin-right:8px;">
                            Withdraw QWD
                        </label>
                        <label style="display:flex;align-items:center;cursor:pointer;">
                            <input type="radio" name="dexOperation" value="trade" style="width:auto;margin-right:8px;">
                            Trade
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Token Amount</label>
                    <input type="number" id="dexTokenAmount" placeholder="0.00000000" step="0.00000001" min="0">
                </div>

                <div class="form-group">
                    <label>QWD Amount</label>
                    <input type="number" id="dexQwdAmount" placeholder="0.00000000" step="0.00000001" min="0">
                </div>

                <div class="form-group" style="display:flex;gap:20px;">
                    <label style="display:flex;align-items:center;cursor:pointer;">
                        <input type="checkbox" id="dexUsePrimaryEncryption" checked style="width:auto;margin-right:8px;">
                        Use Primary Encryption
                    </label>
                </div>

                <div style="display:flex;gap:10px;">
                    <button class="btn-primary" onclick="executeDexOperation()">Execute</button>
                    <button style="background:green;color:white;" class="btn" onclick="buyToken()">Buy Token</button>
                    <button style="background:red;color:white;" class="btn" onclick="sellToken()">Sell Token</button>
                </div>
            </div>

            <div class="card">
                <h3>My Holdings</h3>
                <div id="dexHoldings" style="font-family:monospace;font-size:12px;">
                    <p style="color:#666;">Select a token to view holdings</p>
                </div>
            </div>

            <div class="card">
                <h3>Pool Information</h3>
                <div id="dexPoolInfo" style="font-family:monospace;font-size:12px;">
                    <p style="color:#666;">Select a token to view pool info</p>
                </div>
            </div>
        </div>

        <!-- Peers Panel -->
        <div class="panel" id="panel-peers">
            <div class="card">
                <h3>Network Peers</h3>
                <div style="display:flex;gap:10px;margin-bottom:15px;align-items:center;">
                    <button class="btn-secondary" onclick="updatePeers()">Refresh</button>
                    <span id="peerSummary" style="color:#888;font-size:12px;margin-left:auto;"></span>
                </div>
            </div>

            <div class="card">
                <h3>Connected Peers</h3>
                <div id="connectedPeersContainer">
                    <p style="color:#666;">Loading peer information...</p>
                </div>
            </div>

            <div class="card">
                <h3>Banned Peers</h3>
                <div id="bannedPeersContainer">
                    <p style="color:#666;">No banned peers</p>
                </div>
            </div>

            <div class="card">
                <h3>Whitelisted IPs</h3>
                <div id="whitelistedIPsContainer">
                    <p style="color:#666;">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Logs Panel -->
        <div class="panel" id="panel-logs">
            <div class="card">
                <h3>Node Logs</h3>
                <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                    <div class="form-group" style="flex:1;min-width:200px;">
                        <label>Log File</label>
                        <select id="logFileSelect" onchange="loadLogs()">
                            <option value="">Today's Log</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex:2;min-width:300px;">
                        <label>Filter (contains)</label>
                        <input type="text" id="logFilter" placeholder="e.g., pubkey, transaction, error" onkeyup="if(event.key==='Enter')loadLogs()">
                    </div>
                    <div class="form-group" style="flex:0;">
                        <label>&nbsp;</label>
                        <button class="btn-primary" onclick="loadLogs()">Search</button>
                    </div>
                </div>
                <div style="display:flex;gap:10px;margin-bottom:15px;">
                    <button class="btn-secondary" onclick="loadLogs()">Refresh</button>
                    <button class="btn-secondary" onclick="loadLogFiles()">Refresh Files</button>
                    <button class="btn-secondary" onclick="clearLogFilter()">Clear Filter</button>
                    <span id="logInfo" style="margin-left:auto;color:#888;font-size:12px;"></span>
                </div>
                <div style="display:flex;gap:10px;margin-bottom:15px;">
                    <button class="btn-secondary" onclick="logsNewerPage()">&larr; Newer</button>
                    <span id="logPageInfo" style="color:#888;font-size:12px;align-self:center;"></span>
                    <button class="btn-secondary" onclick="logsOlderPage()">Older &rarr;</button>
                </div>
            </div>
            <div class="card">
                <div id="logContent" style="font-family:monospace;font-size:11px;max-height:600px;overflow-y:auto;background:rgba(0,0,0,0.4);padding:10px;border-radius:4px;white-space:pre-wrap;word-break:break-all;">
                    Click Refresh to load logs...
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let walletLoaded = false;

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('panel-' + tab.dataset.tab).classList.add('active');
                // Load data for specific tabs
                if (tab.dataset.tab === 'peers') {
                    updatePeers();
                }
            });
        });

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            const tabBtn = document.querySelector('.tab[data-tab="' + tabName + '"]');
            if (tabBtn) tabBtn.classList.add('active');
            const panel = document.getElementById('panel-' + tabName);
            if (panel) panel.classList.add('active');
        }

        // Show message
        function showMessage(text, type = 'success') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'alert alert-' + type;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 5000);
        }

        // API calls
        async function api(endpoint, method = 'GET', body = null) {
            const options = { method, headers: { 'Content-Type': 'application/json' } };
            if (body) options.body = JSON.stringify(body);
            const res = await fetch(API_BASE + endpoint, options);
            return res.json();
        }

        // Load wallet
        async function loadWallet() {
            const walletNumber = parseInt(document.getElementById('walletNumber').value) || 0;
            const password = document.getElementById('walletPassword').value;

            try {
                const res = await api('/api/wallet/load', 'POST', { walletNumber, password });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage('Wallet loaded successfully!');
                    walletLoaded = true;
                    document.getElementById('walletInfoCard').style.display = 'block';
                    document.getElementById('walletDetails').innerHTML =
                        '<p class="wallet-info">Address: ' + res.address + '</p>';
                    if (res.warnings && res.warnings.length > 0) {
                        res.warnings.forEach(w => showMessage(w, 'warning'));
                    }
                    updateAccount();
                    checkWallet(); // Update encryption status
                }
            } catch (e) {
                showMessage('Failed to load wallet: ' + e.message, 'error');
            }
        }

        // Create new wallet
        async function createWallet() {
            const walletNumber = parseInt(document.getElementById('walletNumber').value) || 0;
            const password = document.getElementById('walletPassword').value;

            if (!password) {
                showMessage('Please enter a password', 'error');
                return;
            }

            try {
                const res = await api('/api/wallet/create', 'POST', { walletNumber, password });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage('Wallet created successfully!');
                    walletLoaded = true;
                    document.getElementById('walletInfoCard').style.display = 'block';
                    document.getElementById('walletDetails').innerHTML =
                        '<p class="wallet-info">Address: ' + res.address + '</p>';
                    updateAccount();
                    checkWallet();
                }
            } catch (e) {
                showMessage('Failed to create wallet: ' + e.message, 'error');
            }
        }

        // Change password
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            try {
                const res = await api('/api/wallet/change-password', 'POST', { currentPassword, newPassword });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage('Password changed successfully!');
                }
            } catch (e) {
                showMessage('Failed to change password: ' + e.message, 'error');
            }
        }

        // Show mnemonic
        async function showMnemonic() {
            try {
                const res = await api('/api/wallet/mnemonic');
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    let html = '';
                    if (res.primaryMnemonic) {
                        html += '<div class="alert alert-warning"><strong>Primary:</strong><br>' + res.primaryMnemonic + '</div>';
                    }
                    if (res.secondaryMnemonic) {
                        html += '<div class="alert alert-warning"><strong>Secondary:</strong><br>' + res.secondaryMnemonic + '</div>';
                    }
                    document.getElementById('mnemonicDisplay').innerHTML = html;
                }
            } catch (e) {
                showMessage('Failed to get mnemonic: ' + e.message, 'error');
            }
        }

        // Update stats
        async function updateStats() {
            try {
                const res = await api('/api/stats');
                if (!res.error) {
                    document.getElementById('nodeInfo').textContent =
                        'Node: ' + res.nodeIP + ' | Account: ' + res.delegatedAccount;
                    document.getElementById('blockHeight').textContent = res.height + ' / ' + res.heightMax;
                    document.getElementById('txInBlock').textContent = res.transactions;
                    document.getElementById('txPending').textContent = res.transactionsPending;
                    document.getElementById('difficulty').textContent = res.difficulty;
                    document.getElementById('tps').textContent = res.tps.toFixed(2);
                    document.getElementById('priceOracle').textContent = res.priceOracle.toFixed(2) + ' QWD/USD';
                    document.getElementById('randOracle').textContent = res.randOracle;

                    const syncIndicator = document.getElementById('syncIndicator');
                    const accountSyncIndicator = document.getElementById('accountSyncIndicator');
                    const syncStatusText = document.getElementById('syncStatusText');
                    if (res.syncing) {
                        syncIndicator.classList.remove('synced');
                        accountSyncIndicator.classList.remove('synced');
                        syncStatusText.textContent = 'Syncing...';
                    } else {
                        syncIndicator.classList.add('synced');
                        accountSyncIndicator.classList.add('synced');
                        syncStatusText.textContent = 'Synced';
                    }
                }
            } catch (e) {
                console.error('Failed to update stats:', e);
            }
        }

        // Update account
        async function updateAccount() {
            if (!walletLoaded) return;

            try {
                const res = await api('/api/account');
                if (!res.error) {
                    document.getElementById('totalBalance').textContent = res.totalHoldings.toFixed(8);
                    document.getElementById('availableBalance').textContent = res.balance.toFixed(8) + ' QWD';
                    document.getElementById('stakedAmount').textContent = res.stakedAmount.toFixed(8) + ' QWD';
                    document.getElementById('lockedAmount').textContent = res.lockedAmount.toFixed(8) + ' QWD';
                    document.getElementById('rewardsAmount').textContent = res.rewardsAmount.toFixed(8) + ' QWD';

                    if (res.stakingDetails && res.stakingDetails.length > 0) {
                        let html = '';
                        res.stakingDetails.forEach(s => {
                            html += '<div class="staking-row">';
                            html += '<span>Delegated: ' + s.delegatedAddress.substring(0, 16) + '...</span>';
                            html += '<span>Staked: ' + s.staked.toFixed(4) + ' | Rewards: ' + s.rewards.toFixed(4) + '</span>';
                            html += '</div>';
                        });
                        document.getElementById('stakingDetails').innerHTML = html;
                    }

                    // Account details
                    document.getElementById('accountEscrowDelay').textContent = res.escrowDelay || '0';
                    document.getElementById('accountMultiSig').textContent = res.multiSignNumber || '0';
                    document.getElementById('accountSentCount').textContent = res.sentCount || '0';
                    document.getElementById('accountRecvCount').textContent = res.receivedCount || '0';
                }
            } catch (e) {
                console.error('Failed to update account:', e);
            }

            // Fetch pubkey registration info
            try {
                const pk = await api('/api/pubkey-info');
                if (!pk.error) {
                    const primaryEl = document.getElementById('primaryPubKeyStatus');
                    if (pk.hasPrimary) {
                        primaryEl.textContent = 'Registered';
                        primaryEl.style.color = '#66bb6a';
                    } else {
                        primaryEl.textContent = 'NOT Registered';
                        primaryEl.style.color = '#ef5350';
                    }

                    const secondaryEl = document.getElementById('secondaryPubKeyStatus');
                    if (pk.hasSecondary) {
                        secondaryEl.textContent = 'Registered';
                        secondaryEl.style.color = '#66bb6a';
                    } else {
                        secondaryEl.textContent = 'NOT Registered';
                        secondaryEl.style.color = '#ef5350';
                    }

                    if (pk.addresses && pk.addresses.length > 0) {
                        let html = '<div style="font-size:12px;color:#888;margin-top:5px;">';
                        html += '<div style="margin-bottom:5px;">Registered Addresses:</div>';
                        pk.addresses.forEach(a => {
                            const label = a.primary ? 'Primary' : 'Secondary';
                            const color = a.primary ? '#4fc3f7' : '#ce93d8';
                            html += '<div style="margin-bottom:3px;">';
                            html += '<span style="color:' + color + ';">[' + label + ']</span> ';
                            html += '<span style="color:#aaa;">' + a.address + '</span>';
                            html += '</div>';
                        });
                        html += '</div>';
                        document.getElementById('pubkeyAddresses').innerHTML = html;
                    } else {
                        document.getElementById('pubkeyAddresses').innerHTML =
                            '<p style="color:#888;font-size:12px;">No pubkey addresses registered. Send a transaction with "Include PubKey" to register.</p>';
                    }
                }
            } catch (e) {
                console.error('Failed to fetch pubkey info:', e);
            }
        }

        // Update peers
        async function updatePeers() {
            try {
                const res = await api('/api/peers');
                if (!res.error) {
                    // Update summary
                    document.getElementById('peerSummary').textContent =
                        `Connected: ${res.peerCount} | Banned: ${res.bannedCount}`;

                    // Connected peers
                    if (res.connectedPeers && res.connectedPeers.length > 0) {
                        let html = '<table style="width:100%;border-collapse:collapse;font-size:13px;">';
                        html += '<tr style="background:#1a1a2e;"><th style="padding:8px;text-align:left;">IP Address</th>';
                        html += '<th style="padding:8px;text-align:center;">Trust</th>';
                        html += '<th style="padding:8px;text-align:center;">Node Peer</th>';
                        html += '<th style="padding:8px;text-align:left;">Topics</th></tr>';
                        res.connectedPeers.forEach((p, i) => {
                            const bg = i % 2 === 0 ? '#16213e' : '#1a1a2e';
                            html += `<tr style="background:${bg};">`;
                            html += `<td style="padding:8px;font-family:monospace;">${p.ip}</td>`;
                            html += `<td style="padding:8px;text-align:center;">${p.trustLevel}</td>`;
                            html += `<td style="padding:8px;text-align:center;">${p.isNodePeer ? '<span style="color:#00ff64;">Yes</span>' : '<span style="color:#666;">No</span>'}</td>`;
                            html += `<td style="padding:8px;">${p.topics ? p.topics.join(', ') : '-'}</td>`;
                            html += '</tr>';
                        });
                        html += '</table>';
                        document.getElementById('connectedPeersContainer').innerHTML = html;
                    } else {
                        document.getElementById('connectedPeersContainer').innerHTML =
                            '<p style="color:#666;">No connected peers</p>';
                    }

                    // Banned peers
                    if (res.bannedPeers && res.bannedPeers.length > 0) {
                        let html = '<table style="width:100%;border-collapse:collapse;font-size:13px;">';
                        html += '<tr style="background:#1a1a2e;"><th style="padding:8px;text-align:left;">IP Address</th>';
                        html += '<th style="padding:8px;text-align:center;">Remaining Time</th></tr>';
                        res.bannedPeers.forEach((p, i) => {
                            const bg = i % 2 === 0 ? '#16213e' : '#1a1a2e';
                            const mins = Math.floor(p.remainingTime / 60);
                            const secs = p.remainingTime % 60;
                            html += `<tr style="background:${bg};">`;
                            html += `<td style="padding:8px;font-family:monospace;color:#ff6b6b;">${p.ip}</td>`;
                            html += `<td style="padding:8px;text-align:center;">${mins}m ${secs}s</td>`;
                            html += '</tr>';
                        });
                        html += '</table>';
                        document.getElementById('bannedPeersContainer').innerHTML = html;
                    } else {
                        document.getElementById('bannedPeersContainer').innerHTML =
                            '<p style="color:#666;">No banned peers</p>';
                    }

                    // Whitelisted IPs
                    if (res.whitelistedIPs && res.whitelistedIPs.length > 0) {
                        let html = '<div style="display:flex;flex-wrap:wrap;gap:10px;">';
                        res.whitelistedIPs.forEach(ip => {
                            html += `<span style="background:#1a1a2e;padding:5px 10px;border-radius:4px;font-family:monospace;font-size:12px;">${ip}</span>`;
                        });
                        html += '</div>';
                        document.getElementById('whitelistedIPsContainer').innerHTML = html;
                    } else {
                        document.getElementById('whitelistedIPsContainer').innerHTML =
                            '<p style="color:#666;">No whitelisted IPs</p>';
                    }
                }
            } catch (e) {
                console.error('Failed to update peers:', e);
            }
        }

        // Send transaction
        async function sendTransaction() {
            const recipient = document.getElementById('recipientAddress').value;
            const amount = parseFloat(document.getElementById('sendAmount').value) || 0;
            const lockedAmount = parseFloat(document.getElementById('lockedAmount').value) || 0;
            const releasePerBlock = parseFloat(document.getElementById('releasePerBlock').value) || 0;
            const delegatedAccountForLocking = document.getElementById('delegatedAccountForLocking').value || '1';
            const multiSigTxHash = document.getElementById('multiSigTxHash').value || '';
            const smartContractData = document.getElementById('smartContractData').value || '';
            const includePubKey = document.getElementById('includePubKey').checked;
            const usePrimaryEncryption = document.getElementById('usePrimaryEncryption').checked;

            if (!recipient) {
                showMessage('Please enter recipient address', 'error');
                return;
            }
            if (amount < 0) {
                showMessage('Amount cannot be negative', 'error');
                return;
            }

            try {
                const res = await api('/api/send', 'POST', {
                    recipient,
                    amount,
                    lockedAmount,
                    releasePerBlock,
                    delegatedAccountForLocking,
                    multiSigTxHash,
                    smartContractData,
                    includePubKey,
                    usePrimaryEncryption
                });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage('Transaction sent! Hash: ' + res.txHash);
                    // Clear form
                    document.getElementById('recipientAddress').value = '';
                    document.getElementById('sendAmount').value = '';
                    document.getElementById('multiSigTxHash').value = '';
                    document.getElementById('smartContractData').value = '';
                }
            } catch (e) {
                showMessage('Failed to send transaction: ' + e.message, 'error');
            }
        }

        // Cancel transaction
        async function cancelTransaction() {
            const txHash = document.getElementById('cancelTxHash').value;

            if (!txHash) {
                showMessage('Please enter transaction hash', 'error');
                return;
            }

            try {
                const res = await api('/api/cancel', 'POST', { txHash });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage(res.message || 'Cancel request sent');
                    document.getElementById('cancelTxHash').value = '';
                }
            } catch (e) {
                showMessage('Failed to cancel transaction: ' + e.message, 'error');
            }
        }

        // Staking functions
        async function executeStaking() {
            const action = document.querySelector('input[name="stakingAction"]:checked').value;
            const delegatedAccount = document.getElementById('stakingDelegatedAccount').value || '1';
            const amount = parseFloat(document.getElementById('stakingAmount').value) || 0;
            const intendOperator = document.getElementById('intendOperator').checked;
            const usePrimaryEncryption = document.getElementById('stakingUsePrimaryEncryption').checked;

            if (amount <= 0) {
                showMessage('Please enter a valid amount', 'error');
                return;
            }

            try {
                const res = await api('/api/staking/execute', 'POST', {
                    action,
                    delegatedAccount,
                    amount,
                    intendOperator,
                    includePubKey: false,
                    usePrimaryEncryption
                });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage(res.message || 'Staking transaction sent! Hash: ' + res.txHash);
                    document.getElementById('stakingAmount').value = '';
                }
            } catch (e) {
                showMessage('Staking failed: ' + e.message, 'error');
            }
        }

        // Vote
        async function vote(action) {
            let encryptionName = '';
            if (action.includes('Primary')) {
                encryptionName = document.getElementById('newPrimaryEncryption').value;
            } else {
                encryptionName = document.getElementById('newSecondaryEncryption').value;
            }

            try {
                const res = await api('/api/vote', 'POST', { action, encryptionName });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage(res.message || 'Vote submitted successfully');
                }
            } catch (e) {
                showMessage('Vote failed: ' + e.message, 'error');
            }
        }

        // Pending transactions
        async function refreshPending() {
            try {
                const res = await api('/api/pending');
                if (res.error) {
                    showMessage(res.error, 'error');
                    return;
                }

                const pendingList = document.getElementById('pendingList');
                if (!res.transactions || res.transactions.length === 0) {
                    pendingList.innerHTML = '<p style="color:#666;">No pending transactions</p>';
                    return;
                }

                let html = '<div style="overflow-x:auto;">';
                html += '<p style="color:#888;margin-bottom:10px;">Total pending: ' + res.count + '</p>';
                html += '<table style="width:100%;border-collapse:collapse;font-size:12px;">';
                html += '<tr style="border-bottom:1px solid rgba(255,255,255,0.1);">';
                html += '<th style="padding:8px;text-align:left;">Pool</th>';
                html += '<th style="padding:8px;text-align:left;">Amount</th>';
                html += '<th style="padding:8px;text-align:left;">Sender</th>';
                html += '<th style="padding:8px;text-align:left;">Recipient</th>';
                html += '<th style="padding:8px;text-align:left;">Hash</th>';
                html += '</tr>';

                for (const tx of res.transactions) {
                    const poolColor = tx.pool === 'main' ? '#00d4ff' : (tx.pool === 'escrow' ? '#ffc800' : '#ff4757');
                    html += '<tr style="border-bottom:1px solid rgba(255,255,255,0.05);">';
                    html += '<td style="padding:8px;color:' + poolColor + ';">' + tx.pool.toUpperCase() + '</td>';
                    html += '<td style="padding:8px;">' + tx.amount.toFixed(8) + ' QWD</td>';
                    html += '<td style="padding:8px;font-family:monospace;font-size:10px;">' + tx.sender.substring(0, 12) + '...</td>';
                    html += '<td style="padding:8px;font-family:monospace;font-size:10px;">' + tx.recipient.substring(0, 12) + '...</td>';
                    html += '<td style="padding:8px;font-family:monospace;font-size:10px;word-break:break-all;">' + tx.hash + '</td>';
                    html += '</tr>';
                }

                html += '</table></div>';
                pendingList.innerHTML = html;
                showMessage('Pending transactions refreshed');
            } catch (e) {
                showMessage('Failed to load pending: ' + e.message, 'error');
            }
        }

        // History
        async function refreshHistory() {
            try {
                const res = await api('/api/history');
                if (res.error) {
                    showMessage(res.error, 'error');
                    return;
                }

                const historyList = document.getElementById('historyList');
                if (!res.transactions || res.transactions.length === 0) {
                    historyList.innerHTML = '<p style="color:#666;">No transactions found</p>';
                    return;
                }

                let html = '<div style="overflow-x:auto;">';
                html += '<table style="width:100%;border-collapse:collapse;font-size:12px;">';
                html += '<tr style="border-bottom:1px solid rgba(255,255,255,0.1);">';
                html += '<th style="padding:8px;text-align:left;">Type</th>';
                html += '<th style="padding:8px;text-align:left;">Amount</th>';
                html += '<th style="padding:8px;text-align:left;">Address</th>';
                html += '<th style="padding:8px;text-align:left;">Height</th>';
                html += '<th style="padding:8px;text-align:left;">Hash</th>';
                html += '</tr>';

                for (const tx of res.transactions) {
                    const typeColor = tx.type === 'sent' ? '#ff4757' : '#00ff64';
                    const typeSign = tx.type === 'sent' ? '-' : '+';
                    const addr = tx.type === 'sent' ? tx.recipient : tx.sender;
                    html += '<tr style="border-bottom:1px solid rgba(255,255,255,0.05);">';
                    html += '<td style="padding:8px;color:' + typeColor + ';">' + tx.type.toUpperCase() + '</td>';
                    html += '<td style="padding:8px;color:' + typeColor + ';">' + typeSign + tx.amount.toFixed(8) + ' QWD</td>';
                    html += '<td style="padding:8px;font-family:monospace;font-size:10px;">' + (addr ? addr.substring(0, 16) + '...' : '-') + '</td>';
                    html += '<td style="padding:8px;">' + tx.height + '</td>';
                    html += '<td style="padding:8px;font-family:monospace;font-size:10px;word-break:break-all;">' + tx.hash + '</td>';
                    html += '</tr>';
                }

                html += '</table></div>';
                historyList.innerHTML = html;
                showMessage('History refreshed');
            } catch (e) {
                showMessage('Failed to load history: ' + e.message, 'error');
            }
        }

        // Search details
        async function searchDetails() {
            const query = document.getElementById('searchQuery').value;
            if (!query) {
                showMessage('Please enter a search query', 'error');
                return;
            }

            try {
                const res = await api('/api/details?hash=' + encodeURIComponent(query));
                if (res.error) {
                    showMessage(res.error, 'error');
                    document.getElementById('detailsResult').style.display = 'none';
                } else {
                    document.getElementById('detailsResult').style.display = 'block';

                    let content = 'Type: ' + res.type + '\n\n';

                    if (res.type === 'account') {
                        content += 'Address: ' + res.address + '\n';
                        content += 'Balance: ' + res.balance.toFixed(8) + ' QWD\n';
                        content += 'Transaction Delay: ' + res.transactionDelay + ' blocks\n';
                        content += 'Multi-Sig Required: ' + res.multiSignNumber + '\n';
                        content += 'Total Sent: ' + res.sentCount + ' transactions\n';
                        content += 'Total Received: ' + res.receivedCount + ' transactions\n';

                        if (res.transactions && res.transactions.length > 0) {
                            content += '\n--- Recent Transactions ---\n';
                            for (const tx of res.transactions) {
                                const sign = tx.type === 'sent' ? '-' : '+';
                                const addr = tx.type === 'sent' ? tx.recipient : tx.sender;
                                content += '\n[' + tx.type.toUpperCase() + '] ' + sign + tx.amount.toFixed(8) + ' QWD\n';
                                content += '  ' + (tx.type === 'sent' ? 'To: ' : 'From: ') + addr + '\n';
                                content += '  Height: ' + tx.height + ' | Hash: ' + tx.hash + '\n';
                            }
                        }
                    } else {
                        if (res.location) {
                            content += 'Location: ' + res.location + '\n\n';
                        }
                        content += res.data || JSON.stringify(res, null, 2);
                    }

                    document.getElementById('detailsContent').textContent = content;
                }
            } catch (e) {
                showMessage('Search failed: ' + e.message, 'error');
            }
        }

        // Check wallet info on load
        async function checkWallet() {
            try {
                const res = await api('/api/wallet/info');
                if (res.loaded) {
                    walletLoaded = true;
                    document.getElementById('walletInfoCard').style.display = 'block';
                    document.getElementById('walletDetails').innerHTML =
                        '<p class="wallet-info">Address: ' + res.address + '</p>' +
                        '<p class="wallet-info">Encryption: ' + res.sigName + ' / ' + res.sigName2 + '</p>';
                    // Update encryption status in vote panel
                    document.getElementById('currentPrimary').textContent = res.sigName || 'Unknown';
                    document.getElementById('currentSecondary').textContent = res.sigName2 || 'Unknown';
                }
            } catch (e) {
                console.error('Failed to check wallet:', e);
            }
        }

        async function updateEncryptionStatus() {
            try {
                const res = await api('/api/encryption-status');
                document.getElementById('currentPrimary').textContent = res.primaryName || 'Unknown';
                document.getElementById('currentSecondary').textContent = res.secondaryName || 'Unknown';

                const primaryStatus = document.getElementById('primaryPausedStatus');
                if (res.primaryPaused) {
                    primaryStatus.textContent = 'PAUSED';
                    primaryStatus.style.color = '#ef5350';
                } else {
                    primaryStatus.textContent = 'Active';
                    primaryStatus.style.color = '#66bb6a';
                }

                const secondaryStatus = document.getElementById('secondaryPausedStatus');
                if (res.secondaryPaused) {
                    secondaryStatus.textContent = 'PAUSED';
                    secondaryStatus.style.color = '#ef5350';
                } else {
                    secondaryStatus.textContent = 'Active';
                    secondaryStatus.style.color = '#66bb6a';
                }

                document.getElementById('primaryPubKeyLen').textContent = res.primaryPubKeyLength || '-';
                document.getElementById('primarySigLen').textContent = res.primarySignatureLength || '-';
                document.getElementById('secondaryPubKeyLen').textContent = res.secondaryPubKeyLength || '-';
                document.getElementById('secondarySigLen').textContent = res.secondarySignatureLength || '-';

                if (res.votingWindow !== undefined) {
                    document.getElementById('encVotingWindow').textContent = res.votingWindow;
                }

                // No auto-disable  user has full manual control over encryption choice
            } catch (e) {
                console.error('Failed to update encryption status:', e);
            }
        }

        // Escrow functions
        async function modifyAccount() {
            const escrowDelay = parseInt(document.getElementById('escrowDelay').value) || 0;
            const multiSigNumber = parseInt(document.getElementById('multiSigNumber').value) || 0;
            const multiSigAddresses = document.getElementById('multiSigAddresses').value;
            const includePubKey = document.getElementById('escrowIncludePubKey').checked;
            const usePrimaryEncryption = document.getElementById('escrowUsePrimaryEncryption').checked;

            try {
                const res = await api('/api/escrow/modify', 'POST', {
                    escrowDelay,
                    multiSigNumber,
                    multiSigAddresses,
                    includePubKey,
                    usePrimaryEncryption
                });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage(res.message || 'Account modified successfully! Hash: ' + res.txHash);
                }
            } catch (e) {
                showMessage('Modify account failed: ' + e.message, 'error');
            }
        }

        // Smart Contract functions
        let scParsedABI = [];
        let scFunctionSignatures = {};

        function parseABI() {
            const abiText = document.getElementById('scABI').value.trim();
            if (!abiText) {
                showMessage('Please paste ABI JSON first', 'error');
                return;
            }
            try {
                const abi = JSON.parse(abiText);
                scParsedABI = abi;
                const select = document.getElementById('scFunctionSelect');
                select.innerHTML = '<option value="">-- Select Function --</option>';
                scFunctionSignatures = {};

                for (const item of abi) {
                    if (item.type !== 'function' || !item.name) continue;
                    const inputTypes = (item.inputs || []).map(i => i.type).join(',');
                    const outputTypes = (item.outputs || []).map(o => o.type).join(',');
                    const sig = item.name + '(' + inputTypes + ')';
                    const display = sig + (outputTypes ? '=' + outputTypes : '');
                    const inputNames = (item.inputs || []).map(i => i.type + ' ' + i.name).join(', ');

                    scFunctionSignatures[display] = { signature: sig, inputs: item.inputs || [], inputNames: inputNames };
                    const opt = document.createElement('option');
                    opt.value = display;
                    opt.textContent = display;
                    select.appendChild(opt);
                }
                showMessage('ABI parsed: ' + Object.keys(scFunctionSignatures).length + ' functions found');
            } catch (e) {
                showMessage('Invalid ABI JSON: ' + e.message, 'error');
            }
        }

        function onFunctionSelected() {
            const selected = document.getElementById('scFunctionSelect').value;
            if (selected && scFunctionSignatures[selected]) {
                const info = scFunctionSignatures[selected];
                document.getElementById('scInputParams').placeholder = info.inputNames || 'No parameters';
            }
        }

        async function encodeInputData() {
            const selected = document.getElementById('scFunctionSelect').value;
            if (!selected) {
                showMessage('Please select a function first', 'error');
                return;
            }

            // Extract function signature (part before '=') like Qt GUI does
            const signature = selected.split('=')[0];
            const paramsStr = document.getElementById('scInputParams').value.trim();

            try {
                const res = await api('/api/smartcontract/selector', 'POST', { signature });
                let encoded = res.selector;

                if (paramsStr) {
                    const params = paramsStr.split(',').map(s => s.trim());
                    for (let i = 0; i < params.length; i++) {
                        let p = params[i];
                        // Strip 0x prefix for address check
                        const stripped = p.startsWith('0x') ? p.slice(2) : p;
                        if (stripped.length === 40 && /^[0-9a-fA-F]+$/.test(stripped)) {
                            // address (20 bytes) - left-pad to 32 bytes
                            encoded += stripped.toLowerCase().padStart(64, '0');
                        } else if (p.startsWith('0x')) {
                            // hex number - left-pad to 32 bytes
                            encoded += p.slice(2).padStart(64, '0');
                        } else if ((p.startsWith('"') && p.endsWith('"')) || (p.startsWith("'") && p.endsWith("'"))) {
                            // string - encode like Qt: chunk count + zero + right-padded string
                            const str = p.slice(1, -1);
                            const strHex = Array.from(new TextEncoder().encode(str)).map(b => b.toString(16).padStart(2, '0')).join('');
                            const chunks = Math.ceil(strHex.length / 64) || 1;
                            encoded += int64ToHex32(chunks);
                            encoded += '0'.repeat(64);
                            encoded += strHex.padEnd(chunks * 64, '0');
                        } else {
                            // decimal integer (int64) - encode as big-endian uint64 in last 8 bytes of 32-byte slot
                            encoded += int64ToHex32(parseInt(p, 10));
                        }
                    }
                }

                document.getElementById('scInputData').value = encoded;
                showMessage('Input data encoded');
            } catch (e) {
                showMessage('Encoding failed: ' + e.message, 'error');
            }
        }

        // Encode int64 as 32-byte hex (big-endian uint64 in last 8 bytes, matching Go GetInt64ToBytesSC)
        function int64ToHex32(value) {
            const buf = new ArrayBuffer(8);
            const view = new DataView(buf);
            if (value < 0) {
                // For negative: write as int64 big-endian (two's complement handled by DataView)
                view.setBigInt64(0, BigInt(value), false);
            } else {
                view.setBigUint64(0, BigInt(value), false);
            }
            const hex8 = Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
            return '0'.repeat(48) + hex8;
        }

        async function callSmartContract() {
            const address = document.getElementById('scAddress').value;
            const inputData = document.getElementById('scInputData').value;

            if (!address) {
                showMessage('Please enter contract address', 'error');
                return;
            }

            try {
                const res = await api('/api/smartcontract/call', 'POST', { address, inputData });
                if (res.error) {
                    showMessage(res.error, 'error');
                    document.getElementById('scOutput').value = 'Error: ' + res.error;
                } else {
                    document.getElementById('scOutput').value = res.output || res.result || '';
                    showMessage('Contract called successfully');
                }
            } catch (e) {
                showMessage('Contract call failed: ' + e.message, 'error');
            }
        }

        function prepareContractTx() {
            const address = document.getElementById('scAddress').value;
            const inputData = document.getElementById('scInputData').value;
            if (!address || !inputData) {
                showMessage('Please enter address and encode input data first', 'error');
                return;
            }
            document.getElementById('recipientAddress').value = address;
            document.getElementById('sendAmount').value = '0';
            document.getElementById('smartContractData').value = inputData;
            showTab('send');
            showMessage('Contract call prepared in Send tab');
        }

        async function compileContract() {
            const code = document.getElementById('scSourceCode').value;
            if (!code.trim()) {
                showMessage('Please enter Solidity source code', 'error');
                return;
            }

            try {
                const res = await api('/api/smartcontract/compile', 'POST', { code });
                if (res.error) {
                    showMessage(res.error, 'error');
                    return;
                }
                document.getElementById('scBytecode').value = res.bytecode || '';
                if (res.abi) {
                    document.getElementById('scABI').value = res.abi;
                    parseABI();
                }
                if (res.warning) {
                    showMessage('Compiled with warning: ' + res.warning, 'error');
                } else {
                    showMessage('Contract compiled successfully');
                }
            } catch (e) {
                showMessage('Compilation failed: ' + e.message, 'error');
            }
        }

        function deployContract() {
            const bytecode = document.getElementById('scBytecode').value.trim();
            if (!bytecode) {
                showMessage('No bytecode to deploy. Compile first or paste bytecode.', 'error');
                return;
            }
            document.getElementById('recipientAddress').value = '0';
            document.getElementById('sendAmount').value = '0';
            document.getElementById('smartContractData').value = bytecode;
            showTab('send');
            showMessage('Deploy prepared in Send tab - click Send Transaction to deploy');
        }

        // DEX functions
        async function refreshTokens() {
            try {
                const res = await api('/api/dex/tokens');
                const select = document.getElementById('dexTokenSelect');
                select.innerHTML = '<option value="">-- Select Token --</option>';
                if (res.tokens) {
                    for (const [addr, info] of Object.entries(res.tokens)) {
                        const opt = document.createElement('option');
                        opt.value = addr;
                        const tokenName = info.name || info.symbols || 'Unknown';
                        opt.textContent = tokenName + ' (' + addr + ')';
                        select.appendChild(opt);
                    }
                }
                showMessage('Tokens refreshed');
            } catch (e) {
                showMessage('Failed to refresh tokens: ' + e.message, 'error');
            }
        }

        function copyTokenAddress() {
            const addr = document.getElementById('dexTokenSelect').value;
            if (!addr) {
                showMessage('No token selected', 'error');
                return;
            }
            navigator.clipboard.writeText(addr).then(() => {
                showMessage('Token address copied: ' + addr);
            }).catch(() => {
                showMessage('Failed to copy address', 'error');
            });
        }

        async function updateDexToken() {
            const tokenAddr = document.getElementById('dexTokenSelect').value;
            if (!tokenAddr) return;

            try {
                const res = await api('/api/dex/info?token=' + encodeURIComponent(tokenAddr));
                if (res.holdings) {
                    document.getElementById('dexHoldings').innerHTML = '<pre>' + JSON.stringify(res.holdings, null, 2) + '</pre>';
                }
                if (res.pool) {
                    document.getElementById('dexPoolInfo').innerHTML = '<pre>' + JSON.stringify(res.pool, null, 2) + '</pre>';
                }
            } catch (e) {
                console.error('Failed to get DEX info:', e);
            }
        }

        async function executeDexOperation() {
            const tokenAddr = document.getElementById('dexTokenSelect').value;
            const operation = document.querySelector('input[name="dexOperation"]:checked').value;
            const tokenAmount = parseFloat(document.getElementById('dexTokenAmount').value) || 0;
            const qwdAmount = parseFloat(document.getElementById('dexQwdAmount').value) || 0;
            const usePrimaryEncryption = document.getElementById('dexUsePrimaryEncryption').checked;

            if (!tokenAddr) {
                showMessage('Please select a token', 'error');
                return;
            }

            try {
                const res = await api('/api/dex/execute', 'POST', {
                    tokenAddress: tokenAddr,
                    operation,
                    tokenAmount,
                    qwdAmount,
                    usePrimaryEncryption
                });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage(res.message || 'DEX operation completed! Hash: ' + res.txHash);
                }
            } catch (e) {
                showMessage('DEX operation failed: ' + e.message, 'error');
            }
        }

        async function buyToken() {
            document.querySelector('input[name="dexOperation"][value="trade"]').checked = true;
            const tokenAddr = document.getElementById('dexTokenSelect').value;
            const tokenAmount = parseFloat(document.getElementById('dexTokenAmount').value) || 0;
            const usePrimaryEncryption = document.getElementById('dexUsePrimaryEncryption').checked;

            if (!tokenAddr || tokenAmount <= 0) {
                showMessage('Select token and enter amount', 'error');
                return;
            }

            try {
                const res = await api('/api/dex/trade', 'POST', {
                    tokenAddress: tokenAddr,
                    action: 'buy',
                    amount: tokenAmount,
                    usePrimaryEncryption
                });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage('Buy order sent! Hash: ' + res.txHash);
                }
            } catch (e) {
                showMessage('Buy failed: ' + e.message, 'error');
            }
        }

        async function sellToken() {
            document.querySelector('input[name="dexOperation"][value="trade"]').checked = true;
            const tokenAddr = document.getElementById('dexTokenSelect').value;
            const tokenAmount = parseFloat(document.getElementById('dexTokenAmount').value) || 0;
            const usePrimaryEncryption = document.getElementById('dexUsePrimaryEncryption').checked;

            if (!tokenAddr || tokenAmount <= 0) {
                showMessage('Select token and enter amount', 'error');
                return;
            }

            try {
                const res = await api('/api/dex/trade', 'POST', {
                    tokenAddress: tokenAddr,
                    action: 'sell',
                    amount: tokenAmount,
                    usePrimaryEncryption
                });
                if (res.error) {
                    showMessage(res.error, 'error');
                } else {
                    showMessage('Sell order sent! Hash: ' + res.txHash);
                }
            } catch (e) {
                showMessage('Sell failed: ' + e.message, 'error');
            }
        }

        // Logs functionality
        let logOffset = 0;
        const logLimit = 200;
        let logTotalLines = 0;

        async function loadLogFiles() {
            try {
                const res = await api('/api/logs/files');
                const select = document.getElementById('logFileSelect');
                select.innerHTML = '<option value="">Today\'s Log</option>';
                if (res.files) {
                    for (const file of res.files) {
                        const opt = document.createElement('option');
                        opt.value = file;
                        opt.textContent = file;
                        select.appendChild(opt);
                    }
                }
            } catch (e) {
                console.error('Failed to load log files:', e);
            }
        }

        async function loadLogs() {
            const file = document.getElementById('logFileSelect').value;
            const filter = document.getElementById('logFilter').value;

            try {
                let url = '/api/logs?offset=' + logOffset + '&limit=' + logLimit;
                if (file) url += '&file=' + encodeURIComponent(file);
                if (filter) url += '&filter=' + encodeURIComponent(filter);

                const res = await api(url);
                if (res.error) {
                    document.getElementById('logContent').innerHTML = '<span style="color:#ff4757;">Error: ' + res.error + '</span>';
                    return;
                }

                logTotalLines = res.totalLines || 0;
                const lines = res.lines || [];

                document.getElementById('logInfo').textContent =
                    'File: ' + (res.file || 'unknown') + ' | Total: ' + logTotalLines + ' lines' +
                    (res.filter ? ' | Filter: "' + res.filter + '"' : '');

                const startLine = Math.max(0, logTotalLines - logOffset - lines.length);
                const endLine = logTotalLines - logOffset;
                document.getElementById('logPageInfo').textContent =
                    'Showing lines ' + (startLine + 1) + '-' + endLine + ' of ' + logTotalLines;

                if (lines.length === 0) {
                    document.getElementById('logContent').innerHTML = '<span style="color:#666;">No logs found' +
                        (filter ? ' matching "' + filter + '"' : '') + '</span>';
                    return;
                }

                // Color code log lines
                let html = '';
                for (const line of lines) {
                    let color = '#e0e0e0';
                    if (line.includes('ERROR') || line.includes('error') || line.includes('fails') || line.includes('cannot')) {
                        color = '#ff4757';
                    } else if (line.includes('WARNING') || line.includes('warning') || line.includes('WARN')) {
                        color = '#ffc800';
                    } else if (line.includes('success') || line.includes('SUCCESS') || line.includes('OK')) {
                        color = '#00ff64';
                    } else if (line.includes('pubkey') || line.includes('PubKey') || line.includes('Pubkey')) {
                        color = '#00d4ff';
                    } else if (line.includes('transaction') || line.includes('Transaction')) {
                        color = '#b388ff';
                    }
                    // Escape HTML and add color
                    const escaped = line.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    html += '<div style="color:' + color + ';border-bottom:1px solid rgba(255,255,255,0.05);padding:2px 0;">' + escaped + '</div>';
                }
                document.getElementById('logContent').innerHTML = html;

            } catch (e) {
                document.getElementById('logContent').innerHTML = '<span style="color:#ff4757;">Failed to load logs: ' + e.message + '</span>';
            }
        }

        function logsNewerPage() {
            logOffset = Math.max(0, logOffset - logLimit);
            loadLogs();
        }

        function logsOlderPage() {
            if (logOffset + logLimit < logTotalLines) {
                logOffset += logLimit;
                loadLogs();
            }
        }

        function clearLogFilter() {
            document.getElementById('logFilter').value = '';
            logOffset = 0;
            loadLogs();
        }

        // Initialize
        updateStats();
        checkWallet();
        updateEncryptionStatus();
        loadLogFiles();
        setInterval(updateStats, 1000);  // Every 1 seconds (was 1 second)
        setInterval(() => { if (walletLoaded) updateAccount(); }, 3000);  // Every 3 seconds (was 3 seconds)
        setInterval(updateEncryptionStatus, 10000);  // Every 10 seconds
    </script>
</body>
</html>
